
# note: you may need to install the used libraries first
# to do so just run:
#
# need to learn how to commit and also how to creat and use R project
#
# not plot when run
#
# install.packages(c('zoo', 'plotrix'))
#
# I used the following margins for the graphs
# par(mar=c(4,2.3,2,0))

# need to select it or all first 

# setwd("/Volumes/osx-int/kwccoin-git/R-poll-bias/")

# source("/Volumes/osx-int/kwccoin-git/R-poll-bias/blog-post.R")

print("--- start blog-post.R ---")

library(plotrix)
library(zoo)

source("inc/plot_polls.R")

# load poll data from CSV
polls <- load_polls('polls.csv')

head(polls)

# plot all polls in one graph
plot_polls(polls, "All institutes, all parties")

# plot polls of a single party
# valid keys are: spd, cdu, gru, fdp, lin, pir, afd, rep
plot_polls(polls, party='spd', show_avg=F, main="All polls for SPD")

# include the median plot by omitting the show_avg=F
plot_polls(polls, party='spd', main="All polls for SPD vs. median")

# focus on one polling institute using the inst= parameter
# valid keys are: Emnid, Infratestdimap, Forsa, GMS, Allensbach, INSA, FGW
plot_polls(polls, party='spd', inst='Emnid', main="SPD / TNS Emnid vs. median")
plot_polls(polls, party='spd', inst='Infratestdimap', main="SPD / Infratest dimap vs. median")
plot_polls(polls, party='spd', inst='Forsa', main="SPD / Forsa vs. median")

# generate Tukey's median-difference plot
plot_median_diff(polls, 'spd', 'Forsa', main='SPD / Forsa - Median-difference plot')
# ..and the median bias (= the quarterly median of the median-difference plot)
plot_median_median_diff(polls, 'spd', 'Forsa', main='SPD / Forsa - Median-difference plot')

# more examples, please

plot_polls(polls, party='cdu', inst='FGW', limit=c(2000,2013), main="CDU / Forschungsgruppe Wahlen")
plot_median_median_diff(polls, 'cdu', 'FGW', limit=c(2000,2013), main='CDU / Forschungsgruppe Wahlen - Median-difference plot')

plot_polls(polls, party='lin', inst='FGW', limit=c(2000,2013), main="DIE LINKE / Forschungsgruppe Wahlen")
plot_median_median_diff(polls, 'lin', 'FGW', limit=c(2000,2013), main='DIE LINKE / Forschungsgruppe Wahlen - Median-difference plot')

plot_polls(polls, party='lin', inst='Emnid', limit=c(2000,2013), main="DIE LINKE / Emnid")
plot_median_median_diff(polls, party='lin', inst='Emnid', limit=c(2000,2013), main="DIE LINKE / Emnid - Median-difference plot")

# showing the difference of both median algorithms
spdPolls <- subset(polls, polls$party == 'spd')
simpleMed <- get_median(spdPolls, meanOfMedianPerInstitute=F)
betterMed <- get_median(spdPolls)
plot(simpleMed$date, simpleMed$value, type='l', frame=F, xlab='', cex.axis=0.8, cex.sub=0.9,
     main='Comparison of different quarterly medians for SPD',
     sub='black = simple median, red = mean of median per institute')
lines(betterMed$date, betterMed$value, col='red')

print("=== end blog-post.R ===")
